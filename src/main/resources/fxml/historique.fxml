<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<VBox xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.sgpa.controller.HistoriqueController"
      spacing="20" styleClass="view-root" maxWidth="Infinity" maxHeight="Infinity">
    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Filtres -->
    <HBox spacing="20" alignment="CENTER_LEFT" styleClass="filters-bar">
        <HBox spacing="10" alignment="CENTER_LEFT">
            <Label text="Du:" styleClass="filter-label"/>
            <DatePicker fx:id="dateDebut" promptText="Date debut"/>
        </HBox>
        <HBox spacing="10" alignment="CENTER_LEFT">
            <Label text="Au:" styleClass="filter-label"/>
            <DatePicker fx:id="dateFin" promptText="Date fin"/>
        </HBox>
        <Button text="Filtrer" onAction="#handleFilter" styleClass="action-button, primary">
            <graphic><FontIcon iconLiteral="fas-filter"/></graphic>
        </Button>
        <Button text="Aujourd'hui" onAction="#handleToday" styleClass="action-button">
            <graphic><FontIcon iconLiteral="fas-calendar-day"/></graphic>
        </Button>
        <Button text="Cette semaine" onAction="#handleThisWeek" styleClass="action-button">
            <graphic><FontIcon iconLiteral="fas-calendar-week"/></graphic>
        </Button>
        <Region HBox.hgrow="ALWAYS"/>
        <Label fx:id="lblTotal" text="Total: 0.00 EUR" styleClass="total-label"/>
    </HBox>

    <!-- Table des ventes -->
    <VBox VBox.vgrow="ALWAYS" styleClass="panel">
        <HBox alignment="CENTER_LEFT" spacing="10">
            <FontIcon iconLiteral="fas-history" styleClass="panel-icon"/>
            <Label text="Historique des Ventes" styleClass="panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="lblCount" text="0 vente(s)" styleClass="count-label"/>
            <Button text="Exporter CSV" onAction="#handleExportCSV" styleClass="action-button">
                <graphic><FontIcon iconLiteral="fas-file-csv"/></graphic>
            </Button>
        </HBox>

        <TableView fx:id="tableVentes" VBox.vgrow="ALWAYS" styleClass="data-table">
            <columns>
                <TableColumn fx:id="colId" text="N°" prefWidth="60"/>
                <TableColumn fx:id="colDate" text="Date/Heure" prefWidth="150"/>
                <TableColumn fx:id="colVendeur" text="Vendeur" prefWidth="150"/>
                <TableColumn fx:id="colNbArticles" text="Articles" prefWidth="80"/>
                <TableColumn fx:id="colMontant" text="Montant" prefWidth="100"/>
                <TableColumn fx:id="colOrdonnance" text="Ordonnance" prefWidth="100"/>
            </columns>
            <placeholder>
                <Label text="Aucune vente trouvee"/>
            </placeholder>
        </TableView>
    </VBox>

    <!-- Detail de la vente selectionnee -->
    <VBox fx:id="detailPane" styleClass="panel" visible="false" managed="false">
        <HBox alignment="CENTER_LEFT" spacing="10">
            <FontIcon iconLiteral="fas-receipt" styleClass="panel-icon"/>
            <Label fx:id="lblDetailTitle" text="Detail de la vente N°" styleClass="panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="Fermer" onAction="#handleCloseDetail" styleClass="action-button">
                <graphic><FontIcon iconLiteral="fas-times"/></graphic>
            </Button>
        </HBox>

        <TableView fx:id="tableDetail" maxHeight="200" styleClass="data-table">
            <columns>
                <TableColumn fx:id="colDetailMedicament" text="Medicament" prefWidth="200"/>
                <TableColumn fx:id="colDetailLot" text="N° Lot" prefWidth="120"/>
                <TableColumn fx:id="colDetailQuantite" text="Quantite" prefWidth="80"/>
                <TableColumn fx:id="colDetailPrixUnit" text="Prix Unit." prefWidth="100"/>
                <TableColumn fx:id="colDetailTotal" text="Total" prefWidth="100"/>
            </columns>
        </TableView>

        <HBox alignment="CENTER" spacing="5" styleClass="fefo-info">
            <FontIcon iconLiteral="fas-info-circle" styleClass="info-icon"/>
            <Label text="Les lots affiches correspondent a l'ordre FEFO (premiers expires, premiers sortis)" styleClass="info-text"/>
        </HBox>
    </VBox>

</VBox>
